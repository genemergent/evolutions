function colorArr(e){return[floor(red(e)),floor(green(e)),floor(blue(e))]}function reverseMultiplyBlend(e,n){var t=colorArr(e),i=colorArr(n).map(function(e,n){return floor(e/t[n]*255)});return!!isValidColor(i)&&(colorMode(RGB,255,255,255,1),color(i[0],i[1],i[2],alpha(n)))}function reverseScreenBlend(e,n){var t=colorArr(e),i=colorArr(n),s=t.map(function(e){return 1-e/255}),o=i.map(function(e){return e/255-1}).map(function(e,n){return floor(255*(1+e/s[n]))});return!!isValidColor(o)&&(colorMode(RGB,255,255,255,1),color(o[0],o[1],o[2],alpha(n)))}function reverseOverlayBlend(e,n){var t=colorArr(e),i=colorArr(n),s=[];for(let e=0;e<3;e++)if(t[e]/255<.5)s[e]=floor(i[e]/(2*t[e])*255);else{var o=1-t[e]/255,r=i[e]/255-1;s[e]=floor(255*(1+r/(2*o)))}return!!isValidColor(s)&&(colorMode(RGB,255,255,255,1),color(s[0],s[1],s[2],alpha(n)))}function isValidColor(e){return e[0]>=0&&e[1]>=0&&e[2]>=0&&e[0]<=255&&e[1]<=255&&e[2]<=255}function correctFgColor(e,n){var t=reverseMultiplyBlend(e,n),i=reverseScreenBlend(e,n),s=reverseOverlayBlend(e,n);return t?[MULTIPLY,t]:i?[SCREEN,i]:!!s&&[OVERLAY,s]}function setup(){firstRun=!0,createCanvas(settings.windowSize,settings.windowSize),init()}function init(){function e(e,n,t,i){let s=(e-n)/(t-n);return s<1/3?i[0]:s<2/3?i[1]:i[2]}rnd=new Random(tokenData.hash),colorMode(HSB);let n,t={midnight:color(0,0,3),test:color(113,0,12),charcoal:color(113,0,10),"ultra-black":color(240,5,17),"night sky":color(232,99,12),slate:color(207,3,59),canvas:color(37,8,92),chalk:color(0,0,100),ruby:color(358,64,86),chili:color(358,80,82),flamingo:color(341,47,99),rose:color(350,65,80),salmon:color(11,35,97),tangerine:color(25,77,90),illuminating:color(52,69,96),citron:color(43,60,99),forest:color(133,70,20),moss:color(84,62,46),jade:color(170,75,65),lime:color(110,36,80),avocado:color(120,36,75),mint:color(159,15,85),ink:color(225,70,20),pacific:color(219,66,35),ether:color(209,65,55),water:color(199,36,75),sky:color(200,34,98),lavender:color(257,27,80),plum:color(265,36,75),gold:color(30,86,92),acid:color(130,92,66),amethyst:color(283,95,64),grape:color(287,89,98),cherry:color(360,95,99),autumn:color(30,93,98),emerald:color(130,89,98),blueberry:color(200,91,98),"multi-bright":color(0,89,98),"multi-mid":color(0,85,84),"multi-dark":color(0,60,60),"solana-green":color(158,99,98),"solana-blue":color(187,99,98),"solana-purple":color(291,99,98)},i=[["charcoal","chalk",.02],["midnight","amethyst",.07],["midnight","acid",.05],["midnight","gold",.05],["night sky","grape",.04,!0],["night sky","cherry",.04,!0],["night sky","blueberry",.04,!0],["night sky","emerald",.04,!0],["night sky","autumn",.04,!0],["night sky","rose",.05],["night sky",["grape","emerald"],.05],["night sky",["cherry","blueberry"],.05],["night sky",["autumn","blueberry"],.05],["night sky","multi-bright",.04,!0],["night sky","multi-bright",.04,!0],["night sky","multi-bright",.04,!0],["night sky","multi-bright",.04,!0],["night sky","multi-bright",.04,!0],["night sky",["solana-green","solana-purple","solana-blue"],.04,!0],["charcoal","night sky",.2,!0],["ink","rose",.04],["ink","illuminating",.02],["ink",["illuminating","rose"],.04],["ink","multi-bright",.03,!0],["ink","multi-bright",.03,!0],["slate","illuminating",.05],["canvas","tangerine",.05],["canvas","ruby",.04],["canvas","water",.04],["canvas","sky",.04],["canvas","avocado",.04],["canvas","plum",.04],["canvas","charcoal",.04],["canvas","flamingo",.04],["canvas","lime",.03],["canvas",["tangerine","moss"],.05],["canvas",["tangerine","water"],.05],["canvas","multi-mid",.05,!0],["canvas","multi-mid",.05,!0],["ether","chalk",.02],["jade","chalk",.02],["tangerine","chalk",.02],["chili","chalk",.02],["pacific","chalk",.02],["citron","chalk",.02],["flamingo","chalk",.02],["forest","chalk",.02],["lime","chalk",.02],["lavender","chalk",.02],["ruby","citron",.04],["salmon","tangerine",.1]],s=[["ultra-black","charcoal",.07],["canvas","chalk",.03]];n=rnd.random_between(0,1)>.01?rnd.random_choice(i):rnd.random_choice(s),bgcol=t[n[0]],Array.isArray(n[1])||(n[1]=[n[1]]),fgcol=n[1].map(e=>t[e]);let o=[];fgBlendMode=[];let r=[];blending=[],nColors=fgcol.length;for(let e=0;e<nColors;e++)o[e]=correctFgColor(bgcol,fgcol[e]),1!=n[3]&&0!=o[e]||(brightness(bgcol)<50?o[e]=[SCREEN,fgcol[e]]:o[e]=[MULTIPLY,fgcol[e]]),blending[e]=o[e][0],blending[e]==SCREEN?fgBlendMode[e]=ADD:blending[e]==MULTIPLY?fgBlendMode[e]=MULTIPLY:(blending[e],OVERLAY,fgBlendMode[e]=ADD),r[e]=o[e][1],r[e].setAlpha(max(.01,n[2]/min(1.2,scaleMult))),settings.transparent||console.log(blending[e]);origin_types=["circular","scattered"],loop(),clear(),frameCount=0,pixelDensity(1);for(let e=0;e<nColors;e++)cv[e]=createGraphics(settings.canvasSize,settings.canvasSize),cv[e].pixelDensity(1);let a;a=rnd.random_int(12e3,25e3)/1;let l=floor(rnd.random_between(.0065,.06)*modelCanvasSize);agentSpeed=scaleMult,strokeWeight=1*scaleMult,sensorDist=l,turnSpeed=rnd.random_between(.1,min(.5,35/l)),sensorAngularSpacing=rnd.random_between(12,30),sensorSize=floor(rnd.random_int(4,l/2)),origin_type=rnd.random_choice(origin_types);let c=rnd.random_between(.5,sqrt(.5)),g=rnd.random_between(0,1),d=rnd.random_between(.25,1);if(1==settings.logging){let t={};if(t.hash=tokenData.hash,t.horizon=e(sensorDist,.0065*modelCanvasSize,.06*modelCanvasSize,["cautious","typical","adventurous"]),t.perspective=e(sensorAngularSpacing,12,30,["narrow","typical","broad"]),t.precision=e(sensorSize,4,.03*modelCanvasSize,["precise","typical","hazy"]),t.nimbleness=e(turnSpeed,.1,.5,["relaxed","typical","lively"]),t.origin=origin_type,t.population=e(a,12e3,25e3,["sparse","typical","dense"]),t["environment colour"]=n[0],"multi"==n[1][0].substring(0,5)){let n=e(d,.25,1,["tight","broad","dreamcode"]);t["trail colour"]="technicolor "+n}else t["trail colour"]=n[1].join(" & ");saveJSON(t,tokenData.hash+".json")}sensorAngularSpacing=sensorAngularSpacing*Math.PI/180,sensorSize*=scaleMult,sensorDist*=scaleMult,agents=[];for(let e=0;e<a;e++){let t,i,s=e%nColors,o=rnd.random_between(0,2*PI),a=floor(rnd.random_between(0,c)*modelCanvasSize)*scaleMult,l=createVector(Math.cos(o),Math.sin(o)).mult(a),h=rnd.random_between(0,1),u=rnd.random_between(0,1);colorMode(HSB),"multi"==n[1][s].substring(0,5)?("circular"==origin_type?i=o/(2*PI):"scattered"==origin_type&&(i=h),t=360*(g+(t=d>=.75?i:i<=.5?i*d*2:(1-i)*d*2))):t=0;let m=color(min(360,max(0,(hue(r[s])+t)%360)),saturation(r[s]),brightness(r[s]),alpha(r[s]));if("circular"==origin_type){endFrame=400;let e=.5*modelCanvasSize*scaleMult,n=.5*modelCanvasSize*scaleMult;agents.push(new Particle(l.x+e,l.y+n,o+PI,m,cv[s]))}else"scattered"==origin_type&&(endFrame=600,agents.push(new Particle(scaleMult*floor(modelCanvasSize*h),scaleMult*floor(modelCanvasSize*u),o+PI,m,cv[s])))}settings.transparent||background(bgcol)}function draw(){firstRun&&(firstRun=!1,init()),1===frameCount&&1==settings.dumpVideo&&capturer.start(),frameCount!=endFrame||settings.infiniteEvolution||(noLoop(),settings.dumpImage&&saveCanvas(tokenData.hash,"png"),settings.dumpVideo&&(capturer.stop(),capturer.save())),frameCount>endFrame&&settings.infiniteEvolution;for(let e=0;e<nColors;e++)cv[e].blendMode(fgBlendMode[e]);for(let e=0;e<agents.length;e++)agents[e].show(),agents[e].turn(),agents[e].move();for(let e=0;e<nColors;e++)clear(),settings.transparent||background(bgcol),frameCount%2==0&&cv[e].loadPixels(),blendMode(blending[e]),image(cv[e],0,0,settings.windowSize,settings.windowSize),settings.dumpVideo&&capturer.capture(document.getElementById("defaultCanvas0"))}class Random{constructor(e){this.seed=parseInt(e.slice(0,16),16)}random_dec(){return this.seed^=this.seed<<13,this.seed^=this.seed>>17,this.seed^=this.seed<<5,(this.seed<0?1+~this.seed:this.seed)%1e3/1e3}random_between(e,n){return e+(n-e)*this.random_dec()}random_int(e,n){return Math.floor(this.random_between(e,n+1))}random_choice(e){return e[Math.floor(this.random_between(0,.99*e.length))]}}p5.disableFriendlyErrors=!0;var modelCanvasSize=1500,cv=[],capturer=new CCapture({format:"webm",quality:.99999,framerate:60});const Vec=(e,n)=>({x:e,y:n});var settings=void 0===settings?{}:settings;settings.canvasSize=void 0===settings.canvasSize?4500:settings.canvasSize,settings.logging=void 0!==settings.logging&&settings.logging,settings.dumpImage=void 0!==settings.dumpImage&&settings.dumpImage,settings.dumpVideo=void 0!==settings.dumpVideo&&settings.dumpVideo,settings.transparent=void 0!==settings.transparent&&settings.transparent,settings.infiniteEvolution=void 0!==settings.infiniteEvolution&&settings.infiniteEvolution,settings.windowSize=void 0===settings.windowSize?Math.min(window.innerWidth,window.innerHeight):settings.windowSize;var bgcol,fgcol,fgBlendMode,blending,nColors,endFrame,firstRun,rnd,agentSpeed,strokeWeight,sensorDist,turnSpeed,sensorAngularSpacing,sensorSize,origin_type,agents,origin_types,scaleMult=Math.floor(Math.max(1,settings.canvasSize/modelCanvasSize));class Particle{constructor(e,n,t,i,s){this.p=Vec(e,n),this.a=t,this.c=i,this.cvx=s,this.cvx.noStroke(),this.cvx.fill(this.c),this.cvx.s=ellipse(this.p.x,this.p.y,strokeWeight,strokeWeight)}sense(e){let n=this.a+e,t=Vec(Math.cos(n),Math.sin(n)),i=Vec(this.p.x+t.x*sensorDist,this.p.y+t.y*sensorDist),s=0;for(let e=-sensorSize;e<=sensorSize;e+=sensorSize/2)for(let n=-sensorSize;n<=sensorSize;n+=sensorSize/2){let t=Vec(i.x+n,i.y+e);(t.x>settings.canvasSize||t.x<0||t.y<0||t.y>settings.canvasSize)&&(t.x=(t.x+settings.canvasSize)%settings.canvasSize,t.y=(t.y+settings.canvasSize)%settings.canvasSize);let o=4*(Math.floor(t.x)+Math.floor(t.y)*settings.canvasSize)+3;s+=Math.abs(this.cvx.pixels[o])}return s}turn(){let e=this.sense(0),n=this.sense(-sensorAngularSpacing),t=this.sense(sensorAngularSpacing),i=rnd.random_between(0,1);e>n&&e>t?this.a+=0:e<n&&e<t?this.a+=2*(i-.5)*turnSpeed*1:t>n?this.a+=i*turnSpeed:n>t&&(this.a-=i*turnSpeed)}move(){let e=Vec(Math.cos(this.a),Math.sin(this.a));this.p=Vec(this.p.x+e.x*agentSpeed,this.p.y+e.y*agentSpeed),(this.p.x>=settings.canvasSize||this.p.x<=0||this.p.y<=0||this.p.y>=settings.canvasSize)&&(this.p.x=(this.p.x+settings.canvasSize)%settings.canvasSize,this.p.y=(this.p.y+settings.canvasSize)%settings.canvasSize)}show(){this.cvx.strokeWeight(strokeWeight),this.cvx.stroke(this.c),this.cvx.point(this.p.x,this.p.y)}}